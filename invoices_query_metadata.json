//
// Endpoint: /invoices/query/metadata
//
// Generated by OpenAPI_JSON_To_Single_Endpoint app.
// Author: Grzegorz Molenda.
// v.3 - 2025, All rights reserved.
// Released under MIT License.
//
  "/invoices/query/metadata" : {
    "post" : {
      "tags" : [
        "Pobieranie faktur"
      ],
      "summary" : "Pobranie listy metadanych faktur",
      "description" : "Zwraca metadane faktur spełniających filtry.\n\nLimit techniczny: ≤ 10 000 rekordów na zestaw filtrów, po jego osiągnięciu <b>isTruncated = true</b> i należy ponownie ustawić <b>dateRange</b>, używając ostatniej daty z wyników (tj. ustawić from/to - w zależności od kierunku sortowania, od daty ostatniego zwróconego rekordu) oraz wyzerować <b>pageOffset</b>.\n\n`Do scenariusza przyrostowego należy używać daty PermanentStorage oraz kolejność sortowania Asc`.\n            \n<b>Scenariusz pobierania przyrostowego (skrót):</b>\n* Gdy <b>hasMore = false</b>, należy zakończyć,\n* Gdy <b>hasMore = true</b> i <b>isTruncated = false</b>, należy zwiększyć <b>pageOffset</b>,\n* Gdy <b>hasMore = true</b> i <b>isTruncated = true</b>, należy zawęzić <b>dateRange</b> (ustawić from od daty ostatniego rekordu), wyzerować <b>pageOffset</b> i kontynuować\n\n**Sortowanie:**\n\n- permanentStorageDate | invoicingDate | issueDate (Asc | Desc) - pole wybierane na podstawie filtrów\n\n\n\n**Wymagane uprawnienia**: `InvoiceRead`.",
      "parameters" : [
        {
          "name" : "sortOrder",
          "in" : "query",
          "description" : "Kolejność sortowania wyników.\n| Wartość | Opis |\n| --- | --- |\n| Asc | Sortowanie rosnąco. |\n| Desc | Sortowanie malejąco. |\n",
          "schema" : {
            "allOf" : [
              {
                "$ref" : "#/components/schemas/SortOrder"
              }
            ],
            "description" : "| Wartość | Opis |\n| --- | --- |\n| Asc | Sortowanie rosnąco. |\n| Desc | Sortowanie malejąco. |\n",
            "default" : "Asc"
          }
        },
        {
          "name" : "pageOffset",
          "in" : "query",
          "description" : "Indeks pierwszej strony wyników (0 = pierwsza strona).",
          "schema" : {
            "minimum" : 0,
            "type" : "integer",
            "format" : "int32",
            "default" : 0
          }
        },
        {
          "name" : "pageSize",
          "in" : "query",
          "description" : "Rozmiar strony wyników.",
          "schema" : {
            "maximum" : 250,
            "minimum" : 10,
            "type" : "integer",
            "format" : "int32",
            "default" : 10
          }
        }
      ],
      "requestBody" : {
        "description" : "Kryteria filtrowania.",
        "content" : {
          "application/json" : {
            "schema" : {
              "required" : [
                "subjectType",
                "dateRange"
              ],
              "allOf" : [
                {
                  "$ref" : "#/components/schemas/InvoiceQueryFilters"
                }
              ]
            },
            "example" : {
              "subjectType" : "Subject1",
              "dateRange" : {
                "dateType" : "PermanentStorage",
                "from" : "2025-08-28T09:22:13.388+00:00",
                "to" : "2025-09-28T09:24:13.388+00:00"
              },
              "amount" : {
                "type" : "Brutto",
                "from" : 100.50,
                "to" : 250.00
              },
              "currencyCodes" : [
                "PLN",
                "EUR"
              ],
              "invoicingMode" : "Online",
              "formType" : "FA",
              "invoiceTypes" : [
                "Vat"
              ],
              "hasAttachment" : true
            }
          }
        }
      },
      "responses" : {
        "200" : {
          "description" : "OK",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/QueryInvoicesMetadataResponse"
              },
              "example" : {
                "hasMore" : false,
                "isTruncated" : false,
                "permanentStorageHwmDate" : "2025-08-28T09:23:55.388+00:00",
                "invoices" : [
                  {
                    "ksefNumber" : "5555555555-20250828-010080615740-E4",
                    "invoiceNumber" : "FA/KUDYO1a7dddfe-610e-4843-84ba-6b887e35266e",
                    "issueDate" : "2025-08-27",
                    "invoicingDate" : "2025-08-28T09:22:13.388+00:00",
                    "acquisitionDate" : "2025-08-28T09:22:56.388+00:00",
                    "permanentStorageDate" : "2025-08-28T09:23:01.388+00:00",
                    "seller" : {
                      "nip" : "5555555555",
                      "name" : "Test Company 1"
                    },
                    "buyer" : {
                      "identifier" : {
                        "type" : "Nip",
                        "value" : "7352765225"
                      },
                      "name" : "Test Company 4"
                    },
                    "netAmount" : 35260.63,
                    "grossAmount" : 43370.57,
                    "vatAmount" : 8109.94,
                    "currency" : "PLN",
                    "invoicingMode" : "Offline",
                    "invoiceType" : "Vat",
                    "formCode" : {
                      "systemCode" : "FA (3)",
                      "schemaVersion" : "1-0E",
                      "value" : "FA"
                    },
                    "isSelfInvoicing" : false,
                    "hasAttachment" : false,
                    "invoiceHash" : "mkht+3m5trnfxlTYhq3QFn74LkEO69MFNlsMAkCDSPA=",
                    "thirdSubjects" : [

                    ]
                  },
                  {
                    "ksefNumber" : "5555555555-20250828-010080615740-E4",
                    "invoiceNumber" : "5265877635-20250925-010020A0A242-0A",
                    "issueDate" : "2025-08-28",
                    "invoicingDate" : "2025-08-28T10:23:13.388+00:00",
                    "acquisitionDate" : "2025-08-28T10:23:56.388+00:00",
                    "permanentStorageDate" : "2025-08-28T10:24:01.388+00:00",
                    "seller" : {
                      "nip" : "5555555555",
                      "name" : "Test Company 1"
                    },
                    "buyer" : {
                      "identifier" : {
                        "type" : "Nip",
                        "value" : "3225081610"
                      },
                      "name" : "Test Company 2"
                    },
                    "netAmount" : 35260.63,
                    "grossAmount" : 43370.57,
                    "vatAmount" : 8109.94,
                    "currency" : "PLN",
                    "invoicingMode" : "Online",
                    "invoiceType" : "Vat",
                    "formCode" : {
                      "systemCode" : "FA (3)",
                      "schemaVersion" : "1-0E",
                      "value" : "FA"
                    },
                    "isSelfInvoicing" : false,
                    "hasAttachment" : true,
                    "invoiceHash" : "o+nMBU8n8TAhy6EjbcdYdHSZVbUspqmCKqOPLhy3zIQ=",
                    "thirdSubjects" : [
                      {
                        "identifier" : {
                          "type" : "InternalId",
                          "value" : "5555555555-12345"
                        },
                        "name" : "Wystawca faktury",
                        "role" : 4
                      }
                    ]
                  }
                ]
              }
            }
          }
        },
        "400" : {
          "description" : "| ExceptionCode | ExceptionDescription                                      | Details                                                                                                                        | \n|---------------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|\n| 21183         | Zakres filtrowania wykracza poza dostępny zakres danych.  | Parametr dateRange.from jest późniejszy niż PermanentStorageHwmDate przy włączonym restrictToPermanentStorageHwmDate. |\n| 21405 | Błąd walidacji danych wejściowych. | {treść błędu z walidatora} |",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/ExceptionResponse"
              }
            }
          },
          "x-summary" : "Bad Request"
        },
        "429" : {
          "description" : "| | req / s | req / min | req / h | grupa\n| --- | --- | --- | --- | --- |\n| **Limity liczby żądań** | 80 | 160 | 200 | invoiceMetadata\n",
          "headers" : {
            "Retry-After" : {
              "schema" : {
                "$ref" : "#/components/schemas/RetryAfter"
              }
            }
          },
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/TooManyRequestsResponse"
              }
            }
          },
          "x-summary" : "Too Many Requests"
        },
        "403" : {
          "description" : "Forbidden"
        },
        "401" : {
          "description" : "Unauthorized"
        }
      },
      "security" : [
        {
          "Bearer" : [

          ]
        }
      ],
      "x-rate-limits" : {
        "perSecond" : 80,
        "perMinute" : 160,
        "perHour" : 200
      },
      "x-sort" : [
        {
          "allowedFields" : [
            "permanentStorageDate",
            "invoicingDate",
            "issueDate"
          ],
          "allowedDirections" : [
            "Asc",
            "Desc"
          ]
        }
      ],
      "x-required-permissions" : [
        "InvoiceRead"
      ]
    }
  }


  "SortOrder" : {
    "enum" : [
      "Asc",
      "Desc"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| Asc | Sortowanie rosnąco. |\n| Desc | Sortowanie malejąco. |\n"
  }


  "InvoiceQueryFilters" : {
    "required" : [
      "dateRange",
      "subjectType"
    ],
    "type" : "object",
    "properties" : {
      "subjectType" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQuerySubjectType"
          }
        ],
        "description" : "Typ podmiotu, którego dotyczą kryteria filtrowania metadanych faktur.\nOkreśla kontekst, w jakim przeszukiwane są dane.\n| Wartość | Opis |\n| --- | --- |\n| Subject1 | Podmiot 1 - sprzedawca |\n| Subject2 | Podmiot 2 - nabywca |\n| Subject3 | Podmiot 3 |\n| SubjectAuthorized | Podmiot upoważniony |\n"
      },
      "dateRange" : {
        "required" : [
          "dateType",
          "from"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQueryDateRange"
          }
        ],
        "description" : "Typ i zakres dat, według którego mają być filtrowane faktury. Dozwolony maksymalny okres wynosi 3 miesiące."
      },
      "ksefNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/KsefNumber"
          }
        ],
        "description" : "Numer KSeF faktury (exact match).",
        "nullable" : true
      },
      "invoiceNumber" : {
        "maxLength" : 256,
        "type" : "string",
        "description" : "Numer faktury nadany przez wystawcę (exact match).",
        "nullable" : true
      },
      "amount" : {
        "required" : [
          "type"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQueryAmount"
          }
        ],
        "description" : "Filtr kwotowy – brutto, netto lub VAT (z wartością).",
        "nullable" : true
      },
      "sellerNip" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Nip"
          }
        ],
        "description" : "Nip sprzedawcy (exact match).",
        "nullable" : true
      },
      "buyerIdentifier" : {
        "required" : [
          "type"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQueryBuyerIdentifier"
          }
        ],
        "description" : "Identyfikator nabywcy.\n| Type | Value |\n| --- | --- |\n| Nip | 10 cyfrowy numer NIP |\n| VatUe | Identyfikator VAT UE podmiotu unijnego. |\n| Other | Inny identyfikator|\n| None  | Brak identyfikatora nabywcy |",
        "nullable" : true
      },
      "currencyCodes" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/CurrencyCode"
        },
        "description" : "Kody walut.",
        "nullable" : true
      },
      "invoicingMode" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoicingMode"
          }
        ],
        "description" : "Tryb wystawienia faktury: online lub offline.",
        "nullable" : true
      },
      "isSelfInvoicing" : {
        "type" : "boolean",
        "description" : "Czy faktura została wystawiona w trybie samofakturowania.",
        "nullable" : true
      },
      "formType" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQueryFormType"
          }
        ],
        "description" : "Typ dokumentu.\n| Wartość | Opis |\n| --- | --- |\n| FA | Faktura VAT |\n| PEF | Faktura PEF |\n| RR | Faktura RR |\n",
        "nullable" : true
      },
      "invoiceTypes" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/InvoiceType"
        },
        "description" : "Rodzaje faktur.\n| Wartość | Opis |\n| --- | --- |\n| Vat | (FA) Podstawowa |\n| Zal | (FA) Zaliczkowa |\n| Kor | (FA) Korygująca |\n| Roz | (FA) Rozliczeniowa |\n| Upr | (FA) Uproszczona |\n| KorZal | (FA) Korygująca fakturę zaliczkową |\n| KorRoz | (FA) Korygująca fakturę rozliczeniową |\n| VatPef | (PEF) Podstawowa |\n| VatPefSp | (PEF) Specjalizowana |\n| KorPef | (PEF) Korygująca |\n| VatRr | (RR) Podstawowa |\n| KorVatRr | (RR) Korygująca |\n",
        "nullable" : true
      },
      "hasAttachment" : {
        "type" : "boolean",
        "description" : "Czy faktura ma załącznik.",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "InvoiceQuerySubjectType" : {
    "enum" : [
      "Subject1",
      "Subject2",
      "Subject3",
      "SubjectAuthorized"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| Subject1 | Podmiot 1 - sprzedawca |\n| Subject2 | Podmiot 2 - nabywca |\n| Subject3 | Podmiot 3 |\n| SubjectAuthorized | Podmiot upoważniony |\n"
  }


  "InvoiceQueryDateRange" : {
    "required" : [
      "dateType",
      "from"
    ],
    "type" : "object",
    "properties" : {
      "dateType" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceQueryDateType"
          }
        ],
        "description" : "Typ daty, według której ma być zastosowany zakres.\n| Wartość | Opis |\n| --- | --- |\n| Issue | Data wystawienia faktury. |\n| Invoicing | Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania). |\n| PermanentStorage | Data trwałego zapisu faktury w repozytorium systemu KSeF. |\n"
      },
      "from" : {
        "type" : "string",
        "description" : "Data początkowa zakresu(UTC).",
        "format" : "date-time"
      },
      "to" : {
        "type" : "string",
        "description" : "Data końcowa zakresu(UTC). Jeśli nie zostanie podana, przyjmowana jest bieżąca data i czas w UTC.",
        "format" : "date-time",
        "nullable" : true
      },
      "restrictToPermanentStorageHwmDate" : {
        "type" : "boolean",
        "description" : "Określa, czy system ma ograniczyć filtrowanie (zakres dateRange.to) do wartości `PermanentStorageHwmDate`.\n\n* Dotyczy wyłącznie zapytań z `dateType = PermanentStorage`,  \n* Gdy `true`, system ogranicza filtrowanie tak, aby wartość `dateRange.to` nie przekraczała wartości `PermanentStorageHwmDate`,  \n* Gdy `null` lub `false`, filtrowanie może wykraczać poza `PermanentStorageHwmDate`.",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "InvoiceQueryDateType" : {
    "enum" : [
      "Issue",
      "Invoicing",
      "PermanentStorage"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| Issue | Data wystawienia faktury. |\n| Invoicing | Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania). |\n| PermanentStorage | Data trwałego zapisu faktury w repozytorium systemu KSeF. |\n"
  }


  "KsefNumber" : {
    "maxLength" : 36,
    "minLength" : 35,
    "pattern" : "^([1-9](\\d[1-9]|[1-9]\\d)\\d{7})-(20[2-9][0-9]|2[1-9]\\d{2}|[3-9]\\d{3})(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])-([0-9A-F]{6})-?([0-9A-F]{6})-([0-9A-F]{2})$",
    "type" : "string",
    "description" : "Numer KSeF o długości 36 znaków jest akceptowany, by zachować kompatybilność wsteczna z KSeF 1.0. W KSeF 2.0 numery są generowane wyłącznie w formacie 35-znakowym."
  }


  "InvoiceQueryAmount" : {
    "required" : [
      "type"
    ],
    "type" : "object",
    "properties" : {
      "type" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/AmountType"
          }
        ]
      },
      "from" : {
        "type" : "number",
        "format" : "double",
        "nullable" : true
      },
      "to" : {
        "type" : "number",
        "format" : "double",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "AmountType" : {
    "enum" : [
      "Brutto",
      "Netto",
      "Vat"
    ],
    "type" : "string"
  }


  "Nip" : {
    "maxLength" : 10,
    "minLength" : 10,
    "pattern" : "^[1-9]((\\d[1-9])|([1-9]\\d))\\d{7}$",
    "type" : "string",
    "description" : "10 cyfrowy numer NIP."
  }


  "InvoiceQueryBuyerIdentifier" : {
    "required" : [
      "type"
    ],
    "type" : "object",
    "properties" : {
      "type" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/BuyerIdentifierType"
          }
        ],
        "description" : "Typ identyfikatora nabywcy.\n| Wartość | Opis |\n| --- | --- |\n| Nip | 10 cyfrowy numer NIP |\n| VatUe | Identyfikator VAT UE podmiotu unijnego |\n| Other | Inny identyfikator |\n| None | Brak identyfikatora nabywcy |\n"
      },
      "value" : {
        "maxLength" : 50,
        "type" : "string",
        "description" : "Wartość identyfikatora nabywcy (exact match).",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "BuyerIdentifierType" : {
    "enum" : [
      "Nip",
      "VatUe",
      "Other",
      "None"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| Nip | 10 cyfrowy numer NIP |\n| VatUe | Identyfikator VAT UE podmiotu unijnego |\n| Other | Inny identyfikator |\n| None | Brak identyfikatora nabywcy |\n"
  }


  "CurrencyCode" : {
    "enum" : [
      "AED",
      "AFN",
      "ALL",
      "AMD",
      "ANG",
      "AOA",
      "ARS",
      "AUD",
      "AWG",
      "AZN",
      "BAM",
      "BBD",
      "BDT",
      "BGN",
      "BHD",
      "BIF",
      "BMD",
      "BND",
      "BOB",
      "BOV",
      "BRL",
      "BSD",
      "BTN",
      "BWP",
      "BYN",
      "BZD",
      "CAD",
      "CDF",
      "CHE",
      "CHF",
      "CHW",
      "CLF",
      "CLP",
      "CNY",
      "COP",
      "COU",
      "CRC",
      "CUC",
      "CUP",
      "CVE",
      "CZK",
      "DJF",
      "DKK",
      "DOP",
      "DZD",
      "EGP",
      "ERN",
      "ETB",
      "EUR",
      "FJD",
      "FKP",
      "GBP",
      "GEL",
      "GGP",
      "GHS",
      "GIP",
      "GMD",
      "GNF",
      "GTQ",
      "GYD",
      "HKD",
      "HNL",
      "HRK",
      "HTG",
      "HUF",
      "IDR",
      "ILS",
      "IMP",
      "INR",
      "IQD",
      "IRR",
      "ISK",
      "JEP",
      "JMD",
      "JOD",
      "JPY",
      "KES",
      "KGS",
      "KHR",
      "KMF",
      "KPW",
      "KRW",
      "KWD",
      "KYD",
      "KZT",
      "LAK",
      "LBP",
      "LKR",
      "LRD",
      "LSL",
      "LYD",
      "MAD",
      "MDL",
      "MGA",
      "MKD",
      "MMK",
      "MNT",
      "MOP",
      "MRU",
      "MUR",
      "MVR",
      "MWK",
      "MXN",
      "MXV",
      "MYR",
      "MZN",
      "NAD",
      "NGN",
      "NIO",
      "NOK",
      "NPR",
      "NZD",
      "OMR",
      "PAB",
      "PEN",
      "PGK",
      "PHP",
      "PKR",
      "PLN",
      "PYG",
      "QAR",
      "RON",
      "RSD",
      "RUB",
      "RWF",
      "SAR",
      "SBD",
      "SCR",
      "SDG",
      "SEK",
      "SGD",
      "SHP",
      "SLL",
      "SOS",
      "SRD",
      "SSP",
      "STN",
      "SVC",
      "SYP",
      "SZL",
      "THB",
      "TJS",
      "TMT",
      "TND",
      "TOP",
      "TRY",
      "TTD",
      "TWD",
      "TZS",
      "UAH",
      "UGX",
      "USD",
      "USN",
      "UYI",
      "UYU",
      "UYW",
      "UZS",
      "VES",
      "VND",
      "VUV",
      "WST",
      "XAF",
      "XAG",
      "XAU",
      "XBA",
      "XBB",
      "XBC",
      "XBD",
      "XCD",
      "XCG",
      "XDR",
      "XOF",
      "XPD",
      "XPF",
      "XPT",
      "XSU",
      "XUA",
      "XXX",
      "YER",
      "ZAR",
      "ZMW",
      "ZWL"
    ],
    "type" : "string"
  }


  "InvoicingMode" : {
    "enum" : [
      "Online",
      "Offline"
    ],
    "type" : "string"
  }


  "InvoiceQueryFormType" : {
    "enum" : [
      "FA",
      "PEF",
      "RR"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| FA | Faktura VAT |\n| PEF | Faktura PEF |\n| RR | Faktura RR |\n"
  }


  "InvoiceType" : {
    "enum" : [
      "Vat",
      "Zal",
      "Kor",
      "Roz",
      "Upr",
      "KorZal",
      "KorRoz",
      "VatPef",
      "VatPefSp",
      "KorPef",
      "VatRr",
      "KorVatRr"
    ],
    "type" : "string",
    "description" : "| Wartość | Opis |\n| --- | --- |\n| Vat | (FA) Podstawowa |\n| Zal | (FA) Zaliczkowa |\n| Kor | (FA) Korygująca |\n| Roz | (FA) Rozliczeniowa |\n| Upr | (FA) Uproszczona |\n| KorZal | (FA) Korygująca fakturę zaliczkową |\n| KorRoz | (FA) Korygująca fakturę rozliczeniową |\n| VatPef | (PEF) Podstawowa |\n| VatPefSp | (PEF) Specjalizowana |\n| KorPef | (PEF) Korygująca |\n| VatRr | (RR) Podstawowa |\n| KorVatRr | (RR) Korygująca |\n"
  }


  "QueryInvoicesMetadataResponse" : {
    "required" : [
      "hasMore",
      "invoices",
      "isTruncated"
    ],
    "type" : "object",
    "properties" : {
      "hasMore" : {
        "type" : "boolean",
        "description" : "Określa, czy istnieją kolejne wyniki zapytania."
      },
      "isTruncated" : {
        "type" : "boolean",
        "description" : "Określa, czy osiągnięto maksymalny dopuszczalny zakres wyników zapytania (10 000)."
      },
      "permanentStorageHwmDate" : {
        "type" : "string",
        "description" : "Dotyczy wyłącznie zapytań filtrowanych po typie daty <b>PermanentStorage</b>.\nJeśli zapytanie dotyczyło najnowszego okresu, wartość ta może być wartością nieznacznie skorygowaną względem górnej granicy podanej w warunkach zapytania.\nDla okresów starszych, będzie to zgodne z warunkami zapytania. \n\nWartość jest stała dla wszystkich stron tego samego zapytania\ni nie zależy od paginacji ani sortowania.\n\nSystem gwarantuje, że dane poniżej tej wartości są spójne i kompletne.\nPonowne zapytania obejmujące zakresem dane poniżej tego kroczącego znacznika czasu nie zwrócą w przyszłości innych wyników (np.dodatkowych faktur). \n\nDla dateType = Issue lub Invoicing – null.",
        "format" : "date-time",
        "nullable" : true
      },
      "invoices" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/InvoiceMetadata"
        },
        "description" : "Lista faktur spełniających kryteria."
      }
    },
    "additionalProperties" : false
  }


  "InvoiceMetadata" : {
    "required" : [
      "acquisitionDate",
      "buyer",
      "currency",
      "formCode",
      "grossAmount",
      "hasAttachment",
      "invoiceHash",
      "invoiceNumber",
      "invoiceType",
      "invoicingDate",
      "invoicingMode",
      "isSelfInvoicing",
      "issueDate",
      "ksefNumber",
      "netAmount",
      "permanentStorageDate",
      "seller",
      "vatAmount"
    ],
    "type" : "object",
    "properties" : {
      "ksefNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/KsefNumber"
          }
        ],
        "description" : "Numer KSeF faktury."
      },
      "invoiceNumber" : {
        "maxLength" : 256,
        "type" : "string",
        "description" : "Numer faktury nadany przez wystawcę."
      },
      "issueDate" : {
        "type" : "string",
        "description" : "Data wystawienia faktury.",
        "format" : "date"
      },
      "invoicingDate" : {
        "type" : "string",
        "description" : "Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania).",
        "format" : "date-time"
      },
      "acquisitionDate" : {
        "type" : "string",
        "description" : "Data nadania numeru KSeF.",
        "format" : "date-time"
      },
      "permanentStorageDate" : {
        "type" : "string",
        "description" : "Data trwałego zapisu faktury w repozytorium systemu KSeF.",
        "format" : "date-time"
      },
      "seller" : {
        "required" : [
          "nip"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceMetadataSeller"
          }
        ],
        "description" : "Dane identyfikujące sprzedawcę."
      },
      "buyer" : {
        "required" : [
          "identifier"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceMetadataBuyer"
          }
        ],
        "description" : "Dane identyfikujące nabywcę."
      },
      "netAmount" : {
        "type" : "number",
        "description" : "Łączna kwota netto.",
        "format" : "double"
      },
      "grossAmount" : {
        "type" : "number",
        "description" : "Łączna kwota brutto.",
        "format" : "double"
      },
      "vatAmount" : {
        "type" : "number",
        "description" : "Łączna kwota VAT.",
        "format" : "double"
      },
      "currency" : {
        "maxLength" : 3,
        "minLength" : 3,
        "type" : "string",
        "description" : "Kod waluty."
      },
      "invoicingMode" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoicingMode"
          }
        ],
        "description" : "Tryb fakturowania (online/offline)."
      },
      "invoiceType" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceType"
          }
        ],
        "description" : "Rodzaj faktury.\n| Wartość | Opis |\n| --- | --- |\n| Vat | (FA) Podstawowa |\n| Zal | (FA) Zaliczkowa |\n| Kor | (FA) Korygująca |\n| Roz | (FA) Rozliczeniowa |\n| Upr | (FA) Uproszczona |\n| KorZal | (FA) Korygująca fakturę zaliczkową |\n| KorRoz | (FA) Korygująca fakturę rozliczeniową |\n| VatPef | (PEF) Podstawowa |\n| VatPefSp | (PEF) Specjalizowana |\n| KorPef | (PEF) Korygująca |\n| VatRr | (RR) Podstawowa |\n| KorVatRr | (RR) Korygująca |\n"
      },
      "formCode" : {
        "required" : [
          "systemCode",
          "schemaVersion",
          "value"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/FormCode"
          }
        ],
        "description" : "Struktura dokumentu faktury.\n\nObsługiwane schematy:\n| SystemCode | SchemaVersion | Value |\n| --- | --- | --- |\n| [FA (2)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(2)_v1-0E.xsd) | 1-0E | FA |\n| [FA (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(3)_v1-0E.xsd) | 1-0E | FA |\n| [PEF (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF(3)_v2-1.xsd) | 2-1 | PEF |\n| [PEF_KOR (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF_KOR(3)_v2-1.xsd) | 2-1 | PEF |\n| FA_RR (1) | 1-0E | RR |\n"
      },
      "isSelfInvoicing" : {
        "type" : "boolean",
        "description" : "Czy faktura została wystawiona w trybie samofakturowania."
      },
      "hasAttachment" : {
        "type" : "boolean",
        "description" : "Określa, czy faktura posiada załącznik."
      },
      "invoiceHash" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Sha256HashBase64"
          }
        ],
        "description" : "Skrót SHA256 faktury, zakodowany w formacie Base64."
      },
      "hashOfCorrectedInvoice" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Sha256HashBase64"
          }
        ],
        "description" : "Skrót SHA256 korygowanej faktury, zakodowany w formacie Base64.",
        "nullable" : true
      },
      "thirdSubjects" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/InvoiceMetadataThirdSubject"
        },
        "description" : "Lista podmiotów trzecich.",
        "nullable" : true
      },
      "authorizedSubject" : {
        "required" : [
          "nip",
          "role"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceMetadataAuthorizedSubject"
          }
        ],
        "description" : "Podmiot upoważniony.",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }



//---------------------------------------------------------------------------------------------------
request: "/invoices/query/metadata?sortOrder={sortOrder}&pageOffset={pageOffset}&pageSize={pageSize}": post: application/json
headers:
Authorization: Bearer {securityToken}
body:
{
  "subjectType": "", // required; type: string; items: #/components/schemas/InvoiceQuerySubjectType; description: Typ podmiotu, którego dotyczą kryteria filtrowania metadanych faktur.
Określa kontekst, w jakim przeszukiwane są dane.
| Wartość | Opis |
| --- | --- |
| Subject1 | Podmiot 1 - sprzedawca |
| Subject2 | Podmiot 2 - nabywca |
| Subject3 | Podmiot 3 |
| SubjectAuthorized | Podmiot upoważniony |
  "dateRange": { // required; type: object; items: #/components/schemas/InvoiceQueryDateRange; description: Typ i zakres dat, według którego mają być filtrowane faktury. Dozwolony maksymalny okres wynosi 3 miesiące.
    "dateType": "", // required; type: string; items: #/components/schemas/InvoiceQueryDateType; description: Typ daty, według której ma być zastosowany zakres.
| Wartość | Opis |
| --- | --- |
| Issue | Data wystawienia faktury. |
| Invoicing | Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania). |
| PermanentStorage | Data trwałego zapisu faktury w repozytorium systemu KSeF. |
    "from": "", // required; type: string; format: date-time; description: Data początkowa zakresu(UTC).
    "to": "", // type: string; format: date-time; nullable: true; description: Data końcowa zakresu(UTC). Jeśli nie zostanie podana, przyjmowana jest bieżąca data i czas w UTC.
    "restrictToPermanentStorageHwmDate": true/false // type: boolean; nullable: true; description: Określa, czy system ma ograniczyć filtrowanie (zakres dateRange.to) do wartości `PermanentStorageHwmDate`.

* Dotyczy wyłącznie zapytań z `dateType = PermanentStorage`,  
* Gdy `true`, system ogranicza filtrowanie tak, aby wartość `dateRange.to` nie przekraczała wartości `PermanentStorageHwmDate`,  
* Gdy `null` lub `false`, filtrowanie może wykraczać poza `PermanentStorageHwmDate`.
  },
  "ksefNumber": "", // type: string; items: #/components/schemas/KsefNumber; description: Numer KSeF faktury (exact match).
  "invoiceNumber": "", // type: string; nullable: true; description: Numer faktury nadany przez wystawcę (exact match).
  "amount": { // type: object; items: #/components/schemas/InvoiceQueryAmount; nullable: true; description: Filtr kwotowy – brutto, netto lub VAT (z wartością).
    "type": "", // required; type: string; items: #/components/schemas/AmountType;
    "from": 0, // type: number; format: double; nullable: true;
    "to": 0 // type: number; format: double; nullable: true;
  },
  "sellerNip": "", // type: string; items: #/components/schemas/Nip; description: Nip sprzedawcy (exact match).
  "buyerIdentifier": { // type: object; items: #/components/schemas/InvoiceQueryBuyerIdentifier; nullable: true; description: Identyfikator nabywcy.
| Type | Value |
| --- | --- |
| Nip | 10 cyfrowy numer NIP |
| VatUe | Identyfikator VAT UE podmiotu unijnego. |
| Other | Inny identyfikator|
| None  | Brak identyfikatora nabywcy |
    "type": "", // required; type: string; items: #/components/schemas/BuyerIdentifierType; description: Typ identyfikatora nabywcy.
| Wartość | Opis |
| --- | --- |
| Nip | 10 cyfrowy numer NIP |
| VatUe | Identyfikator VAT UE podmiotu unijnego |
| Other | Inny identyfikator |
| None | Brak identyfikatora nabywcy |
    "value": "" // type: string; nullable: true; description: Wartość identyfikatora nabywcy (exact match).
  },
  "currencyCodes": [ // type: array; nullable: true; description: Kody walut.
  ],
  "invoicingMode": "", // type: string; items: #/components/schemas/InvoicingMode; description: Tryb wystawienia faktury: online lub offline.
  "isSelfInvoicing": true/false, // type: boolean; nullable: true; description: Czy faktura została wystawiona w trybie samofakturowania.
  "formType": "", // type: string; items: #/components/schemas/InvoiceQueryFormType; description: Typ dokumentu.
| Wartość | Opis |
| --- | --- |
| FA | Faktura VAT |
| PEF | Faktura PEF |
| RR | Faktura RR |
  "invoiceTypes": [ // type: array; nullable: true; description: Rodzaje faktur.
| Wartość | Opis |
| --- | --- |
| Vat | (FA) Podstawowa |
| Zal | (FA) Zaliczkowa |
| Kor | (FA) Korygująca |
| Roz | (FA) Rozliczeniowa |
| Upr | (FA) Uproszczona |
| KorZal | (FA) Korygująca fakturę zaliczkową |
| KorRoz | (FA) Korygująca fakturę rozliczeniową |
| VatPef | (PEF) Podstawowa |
| VatPefSp | (PEF) Specjalizowana |
| KorPef | (PEF) Korygująca |
| VatRr | (RR) Podstawowa |
| KorVatRr | (RR) Korygująca |
  ],
  "hasAttachment": true/false // type: boolean; nullable: true; description: Czy faktura ma załącznik.
}



response (200): application/json
{
  "hasMore": true/false, // required; type: boolean; description: Określa, czy istnieją kolejne wyniki zapytania.
  "isTruncated": true/false, // required; type: boolean; description: Określa, czy osiągnięto maksymalny dopuszczalny zakres wyników zapytania (10 000).
  "permanentStorageHwmDate": "", // type: string; format: date-time; nullable: true; description: Dotyczy wyłącznie zapytań filtrowanych po typie daty <b>PermanentStorage</b>.
Jeśli zapytanie dotyczyło najnowszego okresu, wartość ta może być wartością nieznacznie skorygowaną względem górnej granicy podanej w warunkach zapytania.
Dla okresów starszych, będzie to zgodne z warunkami zapytania. 

Wartość jest stała dla wszystkich stron tego samego zapytania
i nie zależy od paginacji ani sortowania.

System gwarantuje, że dane poniżej tej wartości są spójne i kompletne.
Ponowne zapytania obejmujące zakresem dane poniżej tego kroczącego znacznika czasu nie zwrócą w przyszłości innych wyników (np.dodatkowych faktur). 

Dla dateType = Issue lub Invoicing – null.
  "invoices": [ // required; type: array; description: Lista faktur spełniających kryteria.
    {
      "ksefNumber": "", // required; type: string; items: #/components/schemas/KsefNumber; description: Numer KSeF faktury.
      "invoiceNumber": "", // required; type: string; description: Numer faktury nadany przez wystawcę.
      "issueDate": "", // required; type: string; format: date; description: Data wystawienia faktury.
      "invoicingDate": "", // required; type: string; format: date-time; description: Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania).
      "acquisitionDate": "", // required; type: string; format: date-time; description: Data nadania numeru KSeF.
      "permanentStorageDate": "", // required; type: string; format: date-time; description: Data trwałego zapisu faktury w repozytorium systemu KSeF.
      "seller": { // required; type: object; items: #/components/schemas/InvoiceMetadataSeller; description: Dane identyfikujące sprzedawcę.
        "nip": "", // required; type: string; items: #/components/schemas/Nip; description: Nip sprzedawcy.
        "name": "" // type: string; nullable: true; description: Nazwa sprzedawcy.
      },
      "buyer": { // required; type: object; items: #/components/schemas/InvoiceMetadataBuyer; description: Dane identyfikujące nabywcę.
        "identifier": { // required; type: object; items: #/components/schemas/InvoiceMetadataBuyerIdentifier; description: Identyfikator nabywcy.
| Type | Value |
| --- | --- |
| Nip | 10 cyfrowy numer NIP |
| VatUe | Identyfikator VAT UE podmiotu unijnego |
| Other | Inny identyfikator|
| None  | Brak identyfikatora nabywcy |
          "type": "", // required; type: string; items: #/components/schemas/BuyerIdentifierType; description: Typ identyfikatora nabywcy.
| Wartość | Opis |
| --- | --- |
| Nip | 10 cyfrowy numer NIP |
| VatUe | Identyfikator VAT UE podmiotu unijnego |
| Other | Inny identyfikator |
| None | Brak identyfikatora nabywcy |
          "value": "" // type: string; nullable: true; description: Wartość identyfikatora nabywcy.
        },
        "name": "" // type: string; nullable: true; description: Nazwa nabywcy.
      },
      "netAmount": 0, // required; type: number; format: double; description: Łączna kwota netto.
      "grossAmount": 0, // required; type: number; format: double; description: Łączna kwota brutto.
      "vatAmount": 0, // required; type: number; format: double; description: Łączna kwota VAT.
      "currency": "", // required; type: string; description: Kod waluty.
      "invoicingMode": "", // required; type: string; items: #/components/schemas/InvoicingMode; description: Tryb fakturowania (online/offline).
      "invoiceType": "", // required; type: string; items: #/components/schemas/InvoiceType; description: Rodzaj faktury.
| Wartość | Opis |
| --- | --- |
| Vat | (FA) Podstawowa |
| Zal | (FA) Zaliczkowa |
| Kor | (FA) Korygująca |
| Roz | (FA) Rozliczeniowa |
| Upr | (FA) Uproszczona |
| KorZal | (FA) Korygująca fakturę zaliczkową |
| KorRoz | (FA) Korygująca fakturę rozliczeniową |
| VatPef | (PEF) Podstawowa |
| VatPefSp | (PEF) Specjalizowana |
| KorPef | (PEF) Korygująca |
| VatRr | (RR) Podstawowa |
| KorVatRr | (RR) Korygująca |
      "formCode": { // required; type: object; items: #/components/schemas/FormCode; description: Struktura dokumentu faktury.

Obsługiwane schematy:
| SystemCode | SchemaVersion | Value |
| --- | --- | --- |
| [FA (2)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(2)_v1-0E.xsd) | 1-0E | FA |
| [FA (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(3)_v1-0E.xsd) | 1-0E | FA |
| [PEF (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF(3)_v2-1.xsd) | 2-1 | PEF |
| [PEF_KOR (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF_KOR(3)_v2-1.xsd) | 2-1 | PEF |
| FA_RR (1) | 1-0E | RR |
        "systemCode": "", // required; type: string; description: Kod systemowy
        "schemaVersion": "", // required; type: string; description: Wersja schematu
        "value": "" // required; type: string; description: Wartość
      },
      "isSelfInvoicing": true/false, // required; type: boolean; description: Czy faktura została wystawiona w trybie samofakturowania.
      "hasAttachment": true/false, // required; type: boolean; description: Określa, czy faktura posiada załącznik.
      "invoiceHash": "", // required; type: string; items: #/components/schemas/Sha256HashBase64; description: Skrót SHA256 faktury, zakodowany w formacie Base64.
      "hashOfCorrectedInvoice": "", // type: string; items: #/components/schemas/Sha256HashBase64; description: Skrót SHA256 korygowanej faktury, zakodowany w formacie Base64.
      "thirdSubjects": [ // type: array; nullable: true; description: Lista podmiotów trzecich.
        {
          "identifier": { // required; type: object; items: #/components/schemas/InvoiceMetadataThirdSubjectIdentifier;
            "type": "", // required; type: string; items: #/components/schemas/ThirdSubjectIdentifierType; description: Typ identyfikatora podmiotu trzeciego.
| Wartość | Opis |
| --- | --- |
| Nip | 10 cyfrowy numer NIP |
| InternalId | Identyfikator wewnętrzny, składający się z numeru NIP i 5 cyfr. |
| VatUe | Identyfikator VAT UE podmiotu unijnego |
| Other | Inny identyfikator |
| None | Brak identyfikatora podmiotu trzeciego |
            "value": "" // type: string; nullable: true; description: Wartość identyfikatora podmiotu trzeciego.
          },
          "name": "", // type: string; nullable: true; description: Nazwa podmiotu trzeciego.
          "role": 0 // required; type: integer; format: int32; description: Rola podmiotu trzeciego.
| Wartość | Opis |
| ---- | --- |
| 0 | Inna rola |
| 1 | Faktor - w przypadku gdy na fakturze występują dane faktora |
| 2 | Odbiorca - w przypadku gdy na fakturze występują dane jednostek wewnętrznych, oddziałów, wyodrębnionych w ramach nabywcy, które same nie stanowią nabywcy w rozumieniu ustawy |
| 3 | Podmiot pierwotny - w przypadku gdy na fakturze występują dane podmiotu będącego w stosunku do podatnika podmiotem przejętym lub przekształconym, który dokonywał dostawy lub świadczył usługę. Z wyłączeniem przypadków, o których mowa w art. 106j ust.2 pkt 3 ustawy, gdy dane te wykazywane są w części Podmiot1K |
| 4 | Dodatkowy nabywca - w przypadku gdy na fakturze występują dane kolejnych (innych niż wymieniony w części Podmiot2) nabywców |
| 5 | Wystawca faktury - w przypadku gdy na fakturze występują dane podmiotu wystawiającego fakturę w imieniu podatnika. Nie dotyczy przypadku, gdy wystawcą faktury jest nabywca |
| 6 | Dokonujący płatności - w przypadku gdy na fakturze występują dane podmiotu regulującego zobowiązanie w miejsce nabywcy |
| 7 | Jednostka samorządu terytorialnego - wystawca |
| 8 | Jednostka samorządu terytorialnego - odbiorca |
| 9 | Członek grupy VAT - wystawca |
| 10 | Członek grupy VAT - odbiorca |
| 11 | Pracownik |
        }
      ],
      "authorizedSubject": { // type: object; items: #/components/schemas/InvoiceMetadataAuthorizedSubject; nullable: true; description: Podmiot upoważniony.
        "nip": "", // required; type: string; items: #/components/schemas/Nip; description: Nip podmiotu upoważnionego
        "name": "", // type: string; nullable: true; description: Nazwa podmiotu upoważnionego.
        "role": 0 // required; type: integer; format: int32; description: Rola podmiotu upoważnionego.
| Wartość | Opis |
| ---- | --- |
| 1 | Organ egzekucyjny - w przypadku, o którym mowa w art. 106c pkt 1 ustawy |
| 2 | Komornik sądowy - w przypadku, o którym mowa w art. 106c pkt 2 ustawy |
| 3 | Przedstawiciel podatkowy - w przypadku gdy na fakturze występują dane przedstawiciela podatkowego, o którym mowa w art. 18a - 18d ustawy |
      }
    }
  ]
}
