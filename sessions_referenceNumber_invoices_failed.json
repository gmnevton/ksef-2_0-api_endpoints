//
// Endpoint: /sessions/{referenceNumber}/invoices/failed
//
// Generated by OpenAPI_JSON_To_Single_Endpoint app.
// Author: Grzegorz Molenda.
// v.3 - 2025, All rights reserved.
// Released under MIT License.
//
  "/sessions/{referenceNumber}/invoices/failed" : {
    "get" : {
      "tags" : [
        "Status wysyłki i UPO"
      ],
      "summary" : "Pobranie niepoprawnie przetworzonych faktur sesji",
      "description" : "Zwraca listę niepoprawnie przetworzonych faktur przesłanych w sesji wraz z ich statusami.\n\n**Wymagane uprawnienia**: `InvoiceWrite`, `Introspection`, `PefInvoiceWrite`, `EnforcementOperations`.",
      "parameters" : [
        {
          "name" : "x-continuation-token",
          "in" : "header",
          "description" : "Token służący do pobrania kolejnej strony wyników.",
          "schema" : {
            "type" : "string"
          }
        },
        {
          "name" : "referenceNumber",
          "in" : "path",
          "description" : "Numer referencyjny sesji.",
          "required" : true,
          "schema" : {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        },
        {
          "name" : "pageSize",
          "in" : "query",
          "description" : "Rozmiar strony wyników.",
          "schema" : {
            "maximum" : 1000,
            "minimum" : 10,
            "type" : "integer",
            "format" : "int32",
            "default" : 10
          }
        }
      ],
      "responses" : {
        "200" : {
          "description" : "OK",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SessionInvoicesResponse"
              },
              "example" : {
                "continuationToken" : "...",
                "invoices" : [
                  {
                    "ordinalNumber" : 2,
                    "referenceNumber" : "20250626-EE-2F20AD2000-242386DF86-52",
                    "invoiceHash" : "mkht+3m5trnfxlTYhq3QFn74LkEO69MFNlsMAkCDSPA=",
                    "invoiceFileName" : "invoice1.xml",
                    "invoicingDate" : "2025-07-11T12:23:56.0154302+00:00",
                    "status" : {
                      "code" : 440,
                      "description" : "Duplikat faktury",
                      "details" : [
                        "Duplikat faktury. Faktura o numerze KSeF: 5265877635-20250626-010080DD2B5E-26 została już prawidłowo przesłana do systemu w sesji: 20250626-SO-2F14610000-242991F8C9-B4"
                      ],
                      "extensions" : {
                        "originalSessionReferenceNumber" : "20250626-SO-2F14610000-242991F8C9-B4",
                        "originalKsefNumber" : "5265877635-20250626-010080DD2B5E-26"
                      }
                    }
                  }
                ]
              }
            }
          }
        },
        "400" : {
          "description" : "| ExceptionCode       | ExceptionDescription                                | Details                                                     | \n|---------------------|-----------------------------------------------------|-------------------------------------------------------------|\n| 21173               | Brak sesji o wskazanym numerze referencyjnym.       | Sesja o numerze referencyjnym {referenceNumber} nie została znaleziona.   |\n| 21418               | Przekazany token kontynuacji ma nieprawidłowy format. |   |\n| 21405 | Błąd walidacji danych wejściowych. | {treść błędu z walidatora} |",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/ExceptionResponse"
              }
            }
          },
          "x-summary" : "Bad Request"
        },
        "429" : {
          "description" : "| | req / s | req / min | req / h | grupa\n| --- | --- | --- | --- | --- |\n| **Limity liczby żądań** | 100 | 200 | 2000 | sessionInvoiceList\n",
          "x-summary" : "Too Many Requests"
        },
        "403" : {
          "description" : "Forbidden"
        },
        "401" : {
          "description" : "Unauthorized"
        }
      },
      "security" : [
        {
          "Bearer" : [

          ]
        }
      ],
      "x-rate-limits" : {
        "perSecond" : 100,
        "perMinute" : 200,
        "perHour" : 2000
      },
      "x-required-permissions" : [
        "InvoiceWrite",
        "Introspection",
        "PefInvoiceWrite",
        "EnforcementOperations"
      ]
    }
  }


  "ReferenceNumber" : {
    "maxLength" : 36,
    "minLength" : 36,
    "type" : "string",
    "description" : "Numer referencyjny."
  }


  "SessionInvoicesResponse" : {
    "required" : [
      "invoices"
    ],
    "type" : "object",
    "properties" : {
      "continuationToken" : {
        "type" : "string",
        "description" : "Token służący do pobrania kolejnej strony wyników. Jeśli jest pusty, to nie ma kolejnych stron.",
        "nullable" : true
      },
      "invoices" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/SessionInvoiceStatusResponse"
        },
        "description" : "Lista pobranych faktur."
      }
    },
    "additionalProperties" : false
  }


  "SessionInvoiceStatusResponse" : {
    "required" : [
      "invoiceHash",
      "invoicingDate",
      "ordinalNumber",
      "referenceNumber",
      "status"
    ],
    "type" : "object",
    "properties" : {
      "ordinalNumber" : {
        "minimum" : 1,
        "type" : "integer",
        "description" : "Numer sekwencyjny faktury w ramach sesji.",
        "format" : "int32"
      },
      "invoiceNumber" : {
        "maxLength" : 256,
        "type" : "string",
        "description" : "Numer faktury.",
        "nullable" : true
      },
      "ksefNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/KsefNumber"
          }
        ],
        "description" : "Numer KSeF.",
        "nullable" : true
      },
      "referenceNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        ],
        "description" : "Numer referencyjny faktury."
      },
      "invoiceHash" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Sha256HashBase64"
          }
        ],
        "description" : "Skrót SHA256 faktury, zakodowany w formacie Base64."
      },
      "invoiceFileName" : {
        "maxLength" : 128,
        "type" : "string",
        "description" : "Nazwa pliku faktury (zwracana dla faktur wysyłanych wsadowo).",
        "nullable" : true
      },
      "acquisitionDate" : {
        "type" : "string",
        "description" : "Data nadania numeru KSeF.",
        "format" : "date-time",
        "nullable" : true
      },
      "invoicingDate" : {
        "type" : "string",
        "description" : "Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania).",
        "format" : "date-time"
      },
      "permanentStorageDate" : {
        "type" : "string",
        "description" : "Data trwałego zapisu faktury w repozytorium KSeF. Wartość uzupełniana asynchronicznie w momencie trwałego zapisu; zawsze późniejsza niż <b>acquisitionDate</b>. Podczas sprawdzania statusu może być jeszcze niedostępna.",
        "format" : "date-time",
        "nullable" : true
      },
      "upoDownloadUrl" : {
        "type" : "string",
        "description" : "Adres do pobrania UPO. Link generowany jest przy każdym odpytaniu o status. \nDostęp odbywa się metodą `HTTP GET` i <b>nie należy</b> wysyłać tokenu dostępowego. \nLink nie podlega limitom API i wygasa po określonym czasie w `UpoDownloadUrlExpirationDate`.",
        "format" : "uri",
        "nullable" : true
      },
      "upoDownloadUrlExpirationDate" : {
        "type" : "string",
        "description" : "Data i godzina wygaśnięcia adresu. Po tej dacie link `UpoDownloadUrl` nie będzie już aktywny.",
        "format" : "date-time",
        "nullable" : true
      },
      "invoicingMode" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoicingMode"
          }
        ],
        "description" : "Tryb fakturowania (online/offline).",
        "nullable" : true
      },
      "status" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoiceStatusInfo"
          }
        ],
        "description" : "Status faktury.\n\n| Code | Description | Details | Extensions |\n| --- | --- | --- | ---|\n| 100 | Faktura przyjęta do dalszego przetwarzania | - | - |\n| 150 | Trwa przetwarzanie | - | - |\n| 200 | Sukces | - | - |\n| 405 | Przetwarzanie anulowane z powodu błędu sesji | - | - |\n| 410 | Nieprawidłowy zakres uprawnień | - |  - |\n| 415 | Brak możliwości wysyłania faktury z załącznikiem | - | - |\n| 430 | Błąd weryfikacji pliku faktury | - | -  |\n| 435 | Błąd odszyfrowania pliku | - | - |\n| 440 | Duplikat faktury | - | 'originalSessionReferenceNumber', 'originalKsefNumber'|\n| 450 | Błąd weryfikacji semantyki dokumentu faktury | - | - |\n| 500 | Nieznany błąd ({statusCode}) | - | - |\n| 550 | Operacja została anulowana przez system | Przetwarzanie zostało przerwane z przyczyn wewnętrznych systemu. Spróbuj ponownie |- |"
      }
    },
    "additionalProperties" : false
  }


  "KsefNumber" : {
    "maxLength" : 36,
    "minLength" : 35,
    "pattern" : "^([1-9](\\d[1-9]|[1-9]\\d)\\d{7})-(20[2-9][0-9]|2[1-9]\\d{2}|[3-9]\\d{3})(0[1-9]|1[0-2])(0[1-9]|[12]\\d|3[01])-([0-9A-F]{6})-?([0-9A-F]{6})-([0-9A-F]{2})$",
    "type" : "string",
    "description" : "Numer KSeF o długości 36 znaków jest akceptowany, by zachować kompatybilność wsteczna z KSeF 1.0. W KSeF 2.0 numery są generowane wyłącznie w formacie 35-znakowym."
  }



//---------------------------------------------------------------------------------------------------
request: "/sessions/{referenceNumber}/invoices/failed?pageSize={pageSize}": get: text/plain
headers:
??x-continuation-token: {continuationToken}
Authorization: Bearer {securityToken}
body:
--- no body ---



response (200): application/json
{
  "continuationToken": "", // type: string; nullable: true; description: Token służący do pobrania kolejnej strony wyników. Jeśli jest pusty, to nie ma kolejnych stron.
  "invoices": [ // required; type: array; description: Lista pobranych faktur.
    {
      "ordinalNumber": 0, // required; type: integer; format: int32; description: Numer sekwencyjny faktury w ramach sesji.
      "invoiceNumber": "", // type: string; nullable: true; description: Numer faktury.
      "ksefNumber": "", // type: string; items: #/components/schemas/KsefNumber; description: Numer KSeF.
      "referenceNumber": "", // required; type: string; items: #/components/schemas/ReferenceNumber; description: Numer referencyjny faktury.
      "invoiceHash": "", // required; type: string; items: #/components/schemas/Sha256HashBase64; description: Skrót SHA256 faktury, zakodowany w formacie Base64.
      "invoiceFileName": "", // type: string; nullable: true; description: Nazwa pliku faktury (zwracana dla faktur wysyłanych wsadowo).
      "acquisitionDate": "", // type: string; format: date-time; nullable: true; description: Data nadania numeru KSeF.
      "invoicingDate": "", // required; type: string; format: date-time; description: Data przyjęcia faktury w systemie KSeF (do dalszego przetwarzania).
      "permanentStorageDate": "", // type: string; format: date-time; nullable: true; description: Data trwałego zapisu faktury w repozytorium KSeF. Wartość uzupełniana asynchronicznie w momencie trwałego zapisu; zawsze późniejsza niż <b>acquisitionDate</b>. Podczas sprawdzania statusu może być jeszcze niedostępna.
      "upoDownloadUrl": "", // type: string; format: uri; nullable: true; description: Adres do pobrania UPO. Link generowany jest przy każdym odpytaniu o status. 
Dostęp odbywa się metodą `HTTP GET` i <b>nie należy</b> wysyłać tokenu dostępowego. 
Link nie podlega limitom API i wygasa po określonym czasie w `UpoDownloadUrlExpirationDate`.
      "upoDownloadUrlExpirationDate": "", // type: string; format: date-time; nullable: true; description: Data i godzina wygaśnięcia adresu. Po tej dacie link `UpoDownloadUrl` nie będzie już aktywny.
      "invoicingMode": "", // type: string; items: #/components/schemas/InvoicingMode; description: Tryb fakturowania (online/offline).
      "status": { // required; type: object; items: #/components/schemas/InvoiceStatusInfo; description: Status faktury.

| Code | Description | Details | Extensions |
| --- | --- | --- | ---|
| 100 | Faktura przyjęta do dalszego przetwarzania | - | - |
| 150 | Trwa przetwarzanie | - | - |
| 200 | Sukces | - | - |
| 405 | Przetwarzanie anulowane z powodu błędu sesji | - | - |
| 410 | Nieprawidłowy zakres uprawnień | - |  - |
| 415 | Brak możliwości wysyłania faktury z załącznikiem | - | - |
| 430 | Błąd weryfikacji pliku faktury | - | -  |
| 435 | Błąd odszyfrowania pliku | - | - |
| 440 | Duplikat faktury | - | 'originalSessionReferenceNumber', 'originalKsefNumber'|
| 450 | Błąd weryfikacji semantyki dokumentu faktury | - | - |
| 500 | Nieznany błąd ({statusCode}) | - | - |
| 550 | Operacja została anulowana przez system | Przetwarzanie zostało przerwane z przyczyn wewnętrznych systemu. Spróbuj ponownie |- |
        "code": 0, // required; type: integer; format: int32; description: Kod statusu faktury
        "description": "", // required; type: string; description: Opis statusu
        "details": [ // type: array; nullable: true; description: Dodatkowe szczegóły statusu
        ],
        "extensions": { // type: object; nullable: true; description: Zbiór dodatkowych informacji związanych ze statusem faktury, zapisanych jako pary klucz–wartość.
Umożliwia rozszerzenie modelu o dane specyficzne dla danego przypadku.
        }
      }
    }
  ]
}
