//
// Endpoint: /sessions/online
//
// Generated by OpenAPI_JSON_To_Single_Endpoint app.
// Author: Grzegorz Molenda.
// v.3 - 2025, All rights reserved.
// Released under MIT License.
//
  "/sessions/online" : {
    "post" : {
      "tags" : [
        "Wysyłka interaktywna"
      ],
      "summary" : "Otwarcie sesji interaktywnej",
      "description" : "Otwiera sesję do wysyłki pojedynczych faktur. Należy przekazać schemat wysyłanych faktur oraz informacje o kluczu używanym do szyfrowania.\n\n> Więcej informacji:\n> - [Otwarcie sesji interaktywnej](https://github.com/CIRFMF/ksef-docs/blob/main/sesja-interaktywna.md#1-otwarcie-sesji)\n> - [Klucz publiczny Ministerstwa Finansów](/docs/v2/index.html#tag/Certyfikaty-klucza-publicznego)\n\nAby generować dokumenty UPO w wersji v4-3 w ramach sesji, należy przy jej otwarciu przesłać nagłówek <b>X-KSeF-Feature: upo-v4-3</b>.\nOd 22 grudnia 2025 wersja UPO v4-3 będzie generowana domyślnie.\n\n**Wymagane uprawnienia**: `InvoiceWrite`, `PefInvoiceWrite`, `EnforcementOperations`.",
      "requestBody" : {
        "content" : {
          "application/json" : {
            "schema" : {
              "required" : [
                "formCode",
                "encryption"
              ],
              "allOf" : [
                {
                  "$ref" : "#/components/schemas/OpenOnlineSessionRequest"
                }
              ]
            },
            "example" : {
              "formCode" : {
                "systemCode" : "FA (3)",
                "schemaVersion" : "1-0E",
                "value" : "FA"
              },
              "encryption" : {
                "encryptedSymmetricKey" : "bdUVjqLj+y2q6aBUuLxxXYAMqeDuIBRTyr+hB96DaWKaGzuVHw9p+Nk9vhzgF/Q5cavK2k6eCh6SdsrWI0s9mFFj4A4UJtsyD8Dn3esLfUZ5A1juuG3q3SBi/XOC/+9W+0T/KdwdE393mbiUNyx1K/0bw31vKJL0COeJIDP7usAMDl42/H1TNvkjk+8iZ80V0qW7D+RZdz+tdiY1xV0f2mfgwJ46V0CpZ+sB9UAssRj+eVffavJ0TOg2b5JaBxE8MCAvrF6rO5K4KBjUmoy7PP7g1qIbm8xI2GO0KnfPOO5OWj8rsotRwBgu7x19Ine3qYUvuvCZlXRGGZ5NHIzWPM4O74+gNalaMgFCsmv8mMhETSU4SfAGmJr9edxPjQSbgD5i2X4eDRDMwvyaAa7CP1b2oICju+0L7Fywd2ZtUcr6El++eTVoi8HYsTArntET++gULT7XXjmb8e3O0nxrYiYsE9GMJ7HBGv3NOoJ1NTm3a7U6+c0ZJiBVLvn6xXw10LQX243xH+ehsKo6djQJKYtqcNPaXtCwM1c9RrsOx/wRXyWCtTffqLiaR0LbYvfMJAcEWceG+RaeAx4p37OiQqdJypd6LAv9/0ECWK8Bip8yyoA+0EYiAJb9YuDz2YlQX9Mx9E9FzFIAsgEQ2w723HZYWgPywLb+dlsum4lTZKQ=",
                "initializationVector" : "OmtDQdl6vkOI1GLKZSjgEg=="
              }
            }
          }
        }
      },
      "responses" : {
        "201" : {
          "description" : "Created",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/OpenOnlineSessionResponse"
              },
              "example" : {
                "referenceNumber" : "20250625-SO-2C3E6C8000-B675CF5D68-07",
                "validUntil" : "2025-07-11T12:23:56.0154302+00:00"
              }
            }
          }
        },
        "400" : {
          "description" : "| ExceptionCode | ExceptionDescription | Details |\n|-|-|-|\n| 21405 | Błąd walidacji danych wejściowych. | {treść błędu z walidatora} |",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/ExceptionResponse"
              }
            }
          },
          "x-summary" : "Bad Request"
        },
        "429" : {
          "description" : "| | req / s | req / min | req / h | grupa\n| --- | --- | --- | --- | --- |\n| **Limity liczby żądań** | 100 | 300 | 1200 | onlineSession\n",
          "headers" : {
            "Retry-After" : {
              "schema" : {
                "$ref" : "#/components/schemas/RetryAfter"
              }
            }
          },
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/TooManyRequestsResponse"
              }
            }
          },
          "x-summary" : "Too Many Requests"
        },
        "403" : {
          "description" : "Forbidden"
        },
        "401" : {
          "description" : "Unauthorized"
        }
      },
      "security" : [
        {
          "Bearer" : [

          ]
        }
      ],
      "x-rate-limits" : {
        "perSecond" : 100,
        "perMinute" : 300,
        "perHour" : 1200
      },
      "x-required-permissions" : [
        "InvoiceWrite",
        "PefInvoiceWrite",
        "EnforcementOperations"
      ]
    }
  }


  "OpenOnlineSessionRequest" : {
    "required" : [
      "encryption",
      "formCode"
    ],
    "type" : "object",
    "properties" : {
      "formCode" : {
        "required" : [
          "systemCode",
          "schemaVersion",
          "value"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/FormCode"
          }
        ],
        "description" : "Schemat faktur wysyłanych w ramach sesji.\n\nObsługiwane schematy:\n| SystemCode | SchemaVersion | Value |\n| --- | --- | --- |\n| [FA (2)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(2)_v1-0E.xsd) | 1-0E | FA |\n| [FA (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(3)_v1-0E.xsd) | 1-0E | FA |\n| [PEF (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF(3)_v2-1.xsd) | 2-1 | PEF |\n| [PEF_KOR (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF_KOR(3)_v2-1.xsd) | 2-1 | PEF |\n"
      },
      "encryption" : {
        "required" : [
          "encryptedSymmetricKey",
          "initializationVector"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/EncryptionInfo"
          }
        ],
        "description" : "Symetryczny klucz szyfrujący pliki XML, zaszyfrowany kluczem publicznym Ministerstwa Finansów."
      }
    },
    "additionalProperties" : false
  }


  "FormCode" : {
    "required" : [
      "schemaVersion",
      "systemCode",
      "value"
    ],
    "type" : "object",
    "properties" : {
      "systemCode" : {
        "type" : "string",
        "description" : "Kod systemowy"
      },
      "schemaVersion" : {
        "type" : "string",
        "description" : "Wersja schematu"
      },
      "value" : {
        "type" : "string",
        "description" : "Wartość"
      }
    },
    "additionalProperties" : false
  }


  "EncryptionInfo" : {
    "required" : [
      "encryptedSymmetricKey",
      "initializationVector"
    ],
    "type" : "object",
    "properties" : {
      "encryptedSymmetricKey" : {
        "type" : "string",
        "description" : "Klucz symetryczny o długości 32 bajtów, zaszyfrowany algorytmem RSA (Padding: OAEP z SHA-256), zakodowany w formacie Base64.\n\n[Klucz publiczny Ministerstwa Finansów](/docs/v2/index.html#tag/Certyfikaty-klucza-publicznego)",
        "format" : "byte"
      },
      "initializationVector" : {
        "type" : "string",
        "description" : "Wektor inicjalizujący (IV) o długości 16 bajtów, używany do szyfrowania symetrycznego, zakodowany w formacie Base64.",
        "format" : "byte"
      }
    },
    "additionalProperties" : false
  }


  "OpenOnlineSessionResponse" : {
    "required" : [
      "referenceNumber",
      "validUntil"
    ],
    "type" : "object",
    "properties" : {
      "referenceNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        ],
        "description" : "Numer referencyjny sesji."
      },
      "validUntil" : {
        "type" : "string",
        "description" : "Termin ważności sesji. Po jego upływie sesja zostanie automatycznie zamknięta.",
        "format" : "date-time"
      }
    },
    "additionalProperties" : false
  }


  "ReferenceNumber" : {
    "maxLength" : 36,
    "minLength" : 36,
    "type" : "string",
    "description" : "Numer referencyjny."
  }



//---------------------------------------------------------------------------------------------------
request: "/sessions/online": post: application/json
headers:
Authorization: Bearer {securityToken}
body:
{
  "formCode": { // required; type: object; items: #/components/schemas/FormCode; description: Schemat faktur wysyłanych w ramach sesji.

Obsługiwane schematy:
| SystemCode | SchemaVersion | Value |
| --- | --- | --- |
| [FA (2)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(2)_v1-0E.xsd) | 1-0E | FA |
| [FA (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/FA/schemat_FA(3)_v1-0E.xsd) | 1-0E | FA |
| [PEF (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF(3)_v2-1.xsd) | 2-1 | PEF |
| [PEF_KOR (3)](https://github.com/CIRFMF/ksef-docs/blob/main/faktury/schemy/PEF/Schemat_PEF_KOR(3)_v2-1.xsd) | 2-1 | PEF |
    "systemCode": "", // required; type: string; description: Kod systemowy
    "schemaVersion": "", // required; type: string; description: Wersja schematu
    "value": "" // required; type: string; description: Wartość
  },
  "encryption": { // required; type: object; items: #/components/schemas/EncryptionInfo; description: Symetryczny klucz szyfrujący pliki XML, zaszyfrowany kluczem publicznym Ministerstwa Finansów.
    "encryptedSymmetricKey": "", // required; type: string; format: byte; description: Klucz symetryczny o długości 32 bajtów, zaszyfrowany algorytmem RSA (Padding: OAEP z SHA-256), zakodowany w formacie Base64.

[Klucz publiczny Ministerstwa Finansów](/docs/v2/index.html#tag/Certyfikaty-klucza-publicznego)
    "initializationVector": "" // required; type: string; format: byte; description: Wektor inicjalizujący (IV) o długości 16 bajtów, używany do szyfrowania symetrycznego, zakodowany w formacie Base64.
  }
}



response (201): application/json
{
  "referenceNumber": "", // required; type: string; items: #/components/schemas/ReferenceNumber; description: Numer referencyjny sesji.
  "validUntil": "" // required; type: string; format: date-time; description: Termin ważności sesji. Po jego upływie sesja zostanie automatycznie zamknięta.
}
