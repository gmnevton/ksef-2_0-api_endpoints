//
// Endpoint: /sessions/{referenceNumber}
//
// Generated by OpenAPI_JSON_To_Single_Endpoint app.
// Author: Grzegorz Molenda.
// v.3 - 2025, All rights reserved.
// Released under MIT License.
//
  "/sessions/{referenceNumber}" : {
    "get" : {
      "tags" : [
        "Status wysyłki i UPO"
      ],
      "summary" : "Pobranie statusu sesji",
      "description" : "Sprawdza bieżący status sesji o podanym numerze referencyjnym.\n\n**Wymagane uprawnienia**: `InvoiceWrite`, `Introspection`, `PefInvoiceWrite`, `EnforcementOperations`.",
      "parameters" : [
        {
          "name" : "referenceNumber",
          "in" : "path",
          "description" : "Numer referencyjny sesji.",
          "required" : true,
          "schema" : {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        }
      ],
      "responses" : {
        "200" : {
          "description" : "OK",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SessionStatusResponse"
              },
              "example" : {
                "status" : {
                  "code" : 200,
                  "description" : "Sesja interaktywna przetworzona pomyślnie"
                },
                "dateCreated" : "2025-09-18T15:00:30+00:00",
                "dateUpdated" : "2025-09-18T15:01:20+00:00",
                "upo" : {
                  "pages" : [
                    {
                      "referenceNumber" : "20250918-EU-2EBD6FA000-242EB9B66D-43",
                      "downloadUrl" : "https://api-test.ksef.mf.gov.pl/storage/01/20250918-so-3789a40000-20373e1269-a3/session-upo/upo_00.xml?sv=2025-01-05&st=2025-09-18T14%3A55%3A50Z&se=2025-09-21T15%3A00%3A50Z&sr=b&sp=r&sig=ZlQO6Xtzu3VQQDwmEMfb0VryMxe9WcUgWtkdiB6X2Qo%3D",
                      "downloadUrlExpirationDate" : "2025-09-21T15:00:50+00:00"
                    }
                  ]
                },
                "invoiceCount" : 10,
                "successfulInvoiceCount" : 8,
                "failedInvoiceCount" : 2
              }
            }
          }
        },
        "400" : {
          "description" : "| ExceptionCode       | ExceptionDescription                                | Details                                                     | \n|---------------------|-----------------------------------------------------|-------------------------------------------------------------|\n| 21173               | Brak sesji o wskazanym numerze referencyjnym.       | Sesja o numerze referencyjnym {referenceNumber} nie została znaleziona.   |\n| 21405 | Błąd walidacji danych wejściowych. | {treść błędu z walidatora} |",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/ExceptionResponse"
              }
            }
          },
          "x-summary" : "Bad Request"
        },
        "429" : {
          "description" : "| | req / s | req / min | req / h | grupa\n| --- | --- | --- | --- | --- |\n| **Limity liczby żądań** | 100 | 1200 | 12000 | sessionMisc\n",
          "headers" : {
            "Retry-After" : {
              "schema" : {
                "$ref" : "#/components/schemas/RetryAfter"
              }
            }
          },
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/TooManyRequestsResponse"
              }
            }
          },
          "x-summary" : "Too Many Requests"
        },
        "403" : {
          "description" : "Forbidden"
        },
        "401" : {
          "description" : "Unauthorized"
        }
      },
      "security" : [
        {
          "Bearer" : [

          ]
        }
      ],
      "x-rate-limits" : {
        "perSecond" : 100,
        "perMinute" : 1200,
        "perHour" : 12000
      },
      "x-required-permissions" : [
        "InvoiceWrite",
        "Introspection",
        "PefInvoiceWrite",
        "EnforcementOperations"
      ]
    }
  }


  "ReferenceNumber" : {
    "maxLength" : 36,
    "minLength" : 36,
    "type" : "string",
    "description" : "Numer referencyjny."
  }


  "SessionStatusResponse" : {
    "required" : [
      "dateCreated",
      "dateUpdated",
      "status"
    ],
    "type" : "object",
    "properties" : {
      "status" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/StatusInfo"
          }
        ],
        "description" : "Informacje o aktualnym statusie.\n            \nSesja wsadowa:\n| Code | Description | Details |\n| --- | --- | --- |\n| 100 | Sesja wsadowa rozpoczęta | - |\n| 150 | Trwa przetwarzanie | - |\n| 200 | Sesja wsadowa przetworzona pomyślnie | - |\n| 405 | Błąd weryfikacji poprawności dostarczonych elementów paczki | - |\n| 415 | Błąd odszyfrowania dostarczonego klucza | - |\n| 420 | Przekroczony limit faktur w sesji | - |\n| 430 | Błąd dekompresji pierwotnego archiwum | - |\n| 435 | Błąd odszyfrowania zaszyfrowanych części archiwum | - |\n| 440 | Sesja anulowana | Przekroczono czas wysyłki |\n| 440 | Sesja anulowana | Nie przesłano faktur |\n| 445 | Błąd weryfikacji, brak poprawnych faktur | - |\n| 500 | Nieznany błąd ({statusCode}) | - |\n\nSesja interaktywna:\n| Code | Description | Details |\n| --- | --- | --- |\n| 100 | Sesja interaktywna otwarta | - |\n| 170 | Sesja interaktywna zamknięta | - |\n| 200 | Sesja interaktywna przetworzona pomyślnie | - |\n| 415 | Błąd odszyfrowania dostarczonego klucza | - |\n| 440 | Sesja anulowana | Nie przesłano faktur |\n| 445 | Błąd weryfikacji, brak poprawnych faktur | - |\n| * | description missing | - |"
      },
      "dateCreated" : {
        "type" : "string",
        "description" : "Data utworzenia sesji.",
        "format" : "date-time"
      },
      "dateUpdated" : {
        "type" : "string",
        "description" : "Data ostatniej aktywności w ramach sesji.",
        "format" : "date-time"
      },
      "validUntil" : {
        "type" : "string",
        "description" : "Termin ważności sesji. Po jego upływie sesja zostanie automatycznie zamknięta.",
        "format" : "date-time",
        "nullable" : true,
        "readOnly" : true
      },
      "upo" : {
        "required" : [
          "pages"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/UpoResponse"
          }
        ],
        "description" : "Informacja o UPO sesyjnym, zwracana gdy sesja została zamknięta i UPO zostało wygenerowane.",
        "nullable" : true
      },
      "invoiceCount" : {
        "minimum" : 0,
        "type" : "integer",
        "description" : "Liczba przyjętych faktur w ramach sesji.",
        "format" : "int32",
        "nullable" : true
      },
      "successfulInvoiceCount" : {
        "minimum" : 0,
        "type" : "integer",
        "description" : "Liczba faktur przeprocesowanych w ramach sesji z sukcesem .",
        "format" : "int32",
        "nullable" : true
      },
      "failedInvoiceCount" : {
        "minimum" : 0,
        "type" : "integer",
        "description" : "Liczba faktur przeprocesowanych w ramach sesji z błędem.",
        "format" : "int32",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "StatusInfo" : {
    "required" : [
      "code",
      "description"
    ],
    "type" : "object",
    "properties" : {
      "code" : {
        "type" : "integer",
        "description" : "Kod statusu",
        "format" : "int32"
      },
      "description" : {
        "minLength" : 1,
        "type" : "string",
        "description" : "Opis statusu"
      },
      "details" : {
        "type" : "array",
        "items" : {
          "type" : "string"
        },
        "description" : "Dodatkowe szczegóły statusu",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "UpoResponse" : {
    "required" : [
      "pages"
    ],
    "type" : "object",
    "properties" : {
      "pages" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/UpoPageResponse"
        },
        "description" : "Lista stron UPO."
      }
    },
    "additionalProperties" : false
  }


  "UpoPageResponse" : {
    "required" : [
      "downloadUrl",
      "downloadUrlExpirationDate",
      "referenceNumber"
    ],
    "type" : "object",
    "properties" : {
      "referenceNumber" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        ],
        "description" : "Numer referencyjny strony UPO."
      },
      "downloadUrl" : {
        "type" : "string",
        "description" : "Adres do pobrania strony UPO. Link generowany jest przy każdym odpytaniu o status. \nDostęp odbywa się metodą `HTTP GET` i <b>nie należy</b> wysyłać tokenu dostępowego. \nLink nie podlega limitom API i wygasa po określonym czasie w `DownloadUrlExpirationDate`.\n\nOdpowiedź HTTP zawiera dodatkowe nagłówki:\n- `x-ms-meta-hash` – skrót SHA-256 dokumentu UPO, zakodowany w formacie Base64.",
        "format" : "uri"
      },
      "downloadUrlExpirationDate" : {
        "type" : "string",
        "description" : "Data i godzina wygaśnięcia adresu. Po tej dacie link `DownloadUrl` nie będzie już aktywny.",
        "format" : "date-time"
      }
    },
    "additionalProperties" : false
  }



//---------------------------------------------------------------------------------------------------
request: "/sessions/{referenceNumber}": get: text/plain
headers:
Authorization: Bearer {securityToken}
body:
--- no body ---



response (200): application/json
{
  "status": { // required; type: object; items: #/components/schemas/StatusInfo; description: Informacje o aktualnym statusie.
            
Sesja wsadowa:
| Code | Description | Details |
| --- | --- | --- |
| 100 | Sesja wsadowa rozpoczęta | - |
| 150 | Trwa przetwarzanie | - |
| 200 | Sesja wsadowa przetworzona pomyślnie | - |
| 405 | Błąd weryfikacji poprawności dostarczonych elementów paczki | - |
| 415 | Błąd odszyfrowania dostarczonego klucza | - |
| 420 | Przekroczony limit faktur w sesji | - |
| 430 | Błąd dekompresji pierwotnego archiwum | - |
| 435 | Błąd odszyfrowania zaszyfrowanych części archiwum | - |
| 440 | Sesja anulowana | Przekroczono czas wysyłki |
| 440 | Sesja anulowana | Nie przesłano faktur |
| 445 | Błąd weryfikacji, brak poprawnych faktur | - |
| 500 | Nieznany błąd ({statusCode}) | - |

Sesja interaktywna:
| Code | Description | Details |
| --- | --- | --- |
| 100 | Sesja interaktywna otwarta | - |
| 170 | Sesja interaktywna zamknięta | - |
| 200 | Sesja interaktywna przetworzona pomyślnie | - |
| 415 | Błąd odszyfrowania dostarczonego klucza | - |
| 440 | Sesja anulowana | Nie przesłano faktur |
| 445 | Błąd weryfikacji, brak poprawnych faktur | - |
| * | description missing | - |
    "code": 0, // required; type: integer; format: int32; description: Kod statusu
    "description": "", // required; type: string; description: Opis statusu
    "details": [ // type: array; nullable: true; description: Dodatkowe szczegóły statusu
    ]
  },
  "dateCreated": "", // required; type: string; format: date-time; description: Data utworzenia sesji.
  "dateUpdated": "", // required; type: string; format: date-time; description: Data ostatniej aktywności w ramach sesji.
  "validUntil": "", // type: string; format: date-time; nullable: true; description: Termin ważności sesji. Po jego upływie sesja zostanie automatycznie zamknięta.
  "upo": { // type: object; items: #/components/schemas/UpoResponse; description: Informacja o UPO sesyjnym, zwracana gdy sesja została zamknięta i UPO zostało wygenerowane.
    "pages": [ // required; type: array; description: Lista stron UPO.
      {
        "referenceNumber": "", // required; type: string; items: #/components/schemas/ReferenceNumber; description: Numer referencyjny strony UPO.
        "downloadUrl": "", // required; type: string; format: uri; description: Adres do pobrania strony UPO. Link generowany jest przy każdym odpytaniu o status. 
Dostęp odbywa się metodą `HTTP GET` i <b>nie należy</b> wysyłać tokenu dostępowego. 
Link nie podlega limitom API i wygasa po określonym czasie w `DownloadUrlExpirationDate`.

Odpowiedź HTTP zawiera dodatkowe nagłówki:
- `x-ms-meta-hash` – skrót SHA-256 dokumentu UPO, zakodowany w formacie Base64.
        "downloadUrlExpirationDate": "" // required; type: string; format: date-time; description: Data i godzina wygaśnięcia adresu. Po tej dacie link `DownloadUrl` nie będzie już aktywny.
      }
    ]
  },
  "invoiceCount": 0, // type: integer; format: int32; nullable: true; description: Liczba przyjętych faktur w ramach sesji.
  "successfulInvoiceCount": 0, // type: integer; format: int32; nullable: true; description: Liczba faktur przeprocesowanych w ramach sesji z sukcesem .
  "failedInvoiceCount": 0 // type: integer; format: int32; nullable: true; description: Liczba faktur przeprocesowanych w ramach sesji z błędem.
}
