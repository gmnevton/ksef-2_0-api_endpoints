//
// Endpoint: /invoices/exports/{referenceNumber}
//
// Generated by OpenAPI_JSON_To_Single_Endpoint app.
// Author: Grzegorz Molenda.
// v.3 - 2025, All rights reserved.
// Released under MIT License.
//
  "/invoices/exports/{referenceNumber}" : {
    "get" : {
      "tags" : [
        "Pobieranie faktur"
      ],
      "summary" : "Pobranie statusu eksportu paczki faktur",
      "description" : "Paczka faktur jest dzielona na części o maksymalnym rozmiarze 50 MB. Każda część jest zaszyfrowana algorytmem AES-256-CBC z dopełnieniem PKCS#7, przy użyciu klucza symetrycznego przekazanego podczas inicjowania eksportu. \n\nW przypadku ucięcia wyniku eksportu z powodu przekroczenia limitów, zwracana jest flaga <b>IsTruncated = true</b> oraz odpowiednia data, którą należy wykorzystać do wykonania kolejnego eksportu, aż do momentu, gdy flaga <b>IsTruncated = false</b>.\n\n**Sortowanie:**\n\n- permanentStorageDate | invoicingDate | issueDate (Asc) - pole wybierane na podstawie filtrów\n\n\n\n**Wymagane uprawnienia**: `InvoiceRead`.",
      "parameters" : [
        {
          "name" : "referenceNumber",
          "in" : "path",
          "description" : "Numer referencyjny eksportu faktur.",
          "required" : true,
          "schema" : {
            "$ref" : "#/components/schemas/ReferenceNumber"
          }
        }
      ],
      "responses" : {
        "200" : {
          "description" : "OK",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/InvoiceExportStatusResponse"
              },
              "example" : {
                "status" : {
                  "code" : 200,
                  "description" : "Eksport faktur zakończony sukcesem"
                },
                "completedDate" : "2025-09-16T16:09:40.901091+00:00",
                "package" : {
                  "invoiceCount" : 10000,
                  "size" : 22425060,
                  "parts" : [
                    {
                      "ordinalNumber" : 1,
                      "partName" : "20250925-EH-2D2C11B000-E9C9ED8340-EE-001.zip.aes",
                      "method" : "GET",
                      "url" : "https://ksef-api-storage/storage/00/20250626-eh-2d2c11b000-e9c9ed8340-ee/invoice-part/20250925-EH-2D2C11B000-E9C9ED8340-EE-001.zip.aes?skoid=1ad7cfe8-2cb2-406b-b96c-6eefb55794db&sktid=647754c7-3974-4442-a425-c61341b61c69&skt=2025-06-26T09%3A40%3A54Z&ske=2025-06-26T10%3A10%3A54Z&sks=b&skv=2025-01-05&sv=2025-01-05&se=2025-06-26T10%3A10%3A54Z&sr=b&sp=w&sig=8mKZEU8Reuz%2Fn7wHi4T%2FY8BzLeD5l8bR2xJsBxIgDEY%3D",
                      "partSize" : 22425060,
                      "partHash" : "BKH9Uy1CjBFXiQdDUM2CJYk5LxWTm4fE1lljnl83Ajw=",
                      "encryptedPartSize" : 22425072,
                      "encryptedPartHash" : "HlvwRLc59EJH7O5GoeHEZxTQO5TJ/WP1QH0aFi4x2Ss=",
                      "expirationDate" : "2025-09-16T17:09:40.901091+00:00"
                    }
                  ],
                  "isTruncated" : true,
                  "lastPermanentStorageDate" : "2025-09-11T11:40:40.266578+00:00",
                  "permanentStorageHwmDate" : "2025-09-11T12:00:40.266578+00:00"
                }
              }
            }
          }
        },
        "400" : {
          "description" : "| ExceptionCode       | ExceptionDescription                                | Details                                                       | \n|---------------------|-----------------------------------------------------|---------------------------------------------------------------|\n| 21175               | Wynik zapytania o podanym identyfikatorze nie istnieje.     |                                  |\n| 21405 | Błąd walidacji danych wejściowych. | {treść błędu z walidatora} |",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/ExceptionResponse"
              }
            }
          },
          "x-summary" : "Bad Request"
        },
        "429" : {
          "description" : "| | req / s | req / min | req / h | grupa\n| --- | --- | --- | --- | --- |\n| **Limity liczby żądań** | 100 | 600 | 6000 | invoiceExportStatus\n",
          "headers" : {
            "Retry-After" : {
              "schema" : {
                "$ref" : "#/components/schemas/RetryAfter"
              }
            }
          },
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/TooManyRequestsResponse"
              }
            }
          },
          "x-summary" : "Too Many Requests"
        },
        "403" : {
          "description" : "Forbidden"
        },
        "401" : {
          "description" : "Unauthorized"
        }
      },
      "security" : [
        {
          "Bearer" : [

          ]
        }
      ],
      "x-rate-limits" : {
        "perSecond" : 100,
        "perMinute" : 600,
        "perHour" : 6000
      },
      "x-sort" : [
        {
          "allowedFields" : [
            "permanentStorageDate",
            "invoicingDate",
            "issueDate"
          ],
          "allowedDirections" : "Asc"
        }
      ],
      "x-required-permissions" : [
        "InvoiceRead"
      ]
    }
  }


  "ReferenceNumber" : {
    "maxLength" : 36,
    "minLength" : 36,
    "type" : "string",
    "description" : "Numer referencyjny."
  }


  "InvoiceExportStatusResponse" : {
    "required" : [
      "status"
    ],
    "type" : "object",
    "properties" : {
      "status" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/StatusInfo"
          }
        ],
        "description" : "Status eksportu.\n\n| Code | Description | Details |\n| --- | --- | --- |\n| 100 | Eksport faktur w toku | - |\n| 200 | Eksport faktur zakończony sukcesem | - |\n| 210 | Eksport faktur wygasł i nie jest już dostępny do pobrania | - |\n| 415 | Błąd odszyfrowania dostarczonego klucza  | - |\n| 420 | Zakres filtrowania wykracza poza dostępny zakres danych | Parametr dateRange.from jest późniejszy niż PermanentStorageHwmDate przy włączonym restrictToPermanentStorageHwmDate. |\n| 500 | Nieznany błąd ({statusCode}) | - |\n| 550 | Operacja została anulowana przez system | Przetwarzanie zostało przerwane z przyczyn wewnętrznych systemu. Spróbuj ponownie |"
      },
      "completedDate" : {
        "type" : "string",
        "description" : "Data zakończenia przetwarzania żądania eksportu faktur.",
        "format" : "date-time",
        "nullable" : true
      },
      "packageExpirationDate" : {
        "type" : "string",
        "description" : "Data wygaśnięcia paczki faktur przygotowanej do pobrania.\nPo upływie tej daty paczka nie będzie już dostępna do pobrania.",
        "format" : "date-time",
        "nullable" : true
      },
      "package" : {
        "required" : [
          "invoiceCount",
          "size",
          "parts",
          "isTruncated"
        ],
        "allOf" : [
          {
            "$ref" : "#/components/schemas/InvoicePackage"
          }
        ],
        "description" : "Dane paczki faktur przygotowanej do pobrania.",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "StatusInfo" : {
    "required" : [
      "code",
      "description"
    ],
    "type" : "object",
    "properties" : {
      "code" : {
        "type" : "integer",
        "description" : "Kod statusu",
        "format" : "int32"
      },
      "description" : {
        "minLength" : 1,
        "type" : "string",
        "description" : "Opis statusu"
      },
      "details" : {
        "type" : "array",
        "items" : {
          "type" : "string"
        },
        "description" : "Dodatkowe szczegóły statusu",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "InvoicePackage" : {
    "required" : [
      "invoiceCount",
      "isTruncated",
      "parts",
      "size"
    ],
    "type" : "object",
    "properties" : {
      "invoiceCount" : {
        "maximum" : 10000,
        "minimum" : 0,
        "type" : "integer",
        "description" : "Łączna liczba faktur w paczce.",
        "format" : "int64"
      },
      "size" : {
        "minimum" : 0,
        "type" : "integer",
        "description" : "Rozmiar paczki w bajtach.",
        "format" : "int64"
      },
      "parts" : {
        "type" : "array",
        "items" : {
          "$ref" : "#/components/schemas/InvoicePackagePart"
        },
        "description" : "Lista dostępnych części paczki do pobrania."
      },
      "isTruncated" : {
        "type" : "boolean",
        "description" : "Określa, czy wynik eksportu został ucięty z powodu przekroczenia limitu liczby faktur lub wielkości paczki."
      },
      "lastIssueDate" : {
        "type" : "string",
        "description" : "Data wystawienia ostatniej faktury ujętej w paczce.\nPole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `Issue`.",
        "format" : "date",
        "nullable" : true
      },
      "lastInvoicingDate" : {
        "type" : "string",
        "description" : "Data przyjęcia ostatniej faktury ujętej w paczce.\nPole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `Invoicing`.",
        "format" : "date-time",
        "nullable" : true
      },
      "lastPermanentStorageDate" : {
        "type" : "string",
        "description" : "Data trwałego zapisu ostatniej faktury ujętej w paczce.\nPole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `PermanentStorage`.",
        "format" : "date-time",
        "nullable" : true
      },
      "permanentStorageHwmDate" : {
        "type" : "string",
        "description" : "Dotyczy wyłącznie zapytań filtrowanych po typie daty <b>PermanentStorage</b>.\nJeśli zapytanie dotyczyło najnowszego okresu, wartość ta może być wartością nieznacznie skorygowaną względem górnej granicy podanej w warunkach zapytania.\nDla okresów starszych, będzie to zgodne z warunkami zapytania. \n\nSystem gwarantuje, że dane poniżej tej wartości są spójne i kompletne.\nPonowne zapytania obejmujące zakresem dane poniżej tego kroczącego znacznika czasu nie zwrócą w przyszłości innych wyników (np.dodatkowych faktur). \n\nDla dateType = Issue lub Invoicing – null.",
        "format" : "date-time",
        "nullable" : true
      }
    },
    "additionalProperties" : false
  }


  "InvoicePackagePart" : {
    "required" : [
      "encryptedPartHash",
      "encryptedPartSize",
      "expirationDate",
      "method",
      "ordinalNumber",
      "partHash",
      "partName",
      "partSize",
      "url"
    ],
    "type" : "object",
    "properties" : {
      "ordinalNumber" : {
        "minimum" : 1,
        "type" : "integer",
        "description" : "Numer sekwencyjny pliku części paczki.",
        "format" : "int32"
      },
      "partName" : {
        "maxLength" : 100,
        "type" : "string",
        "description" : "Nazwa pliku części paczki."
      },
      "method" : {
        "type" : "string",
        "description" : "Metoda HTTP, której należy użyć przy pobieraniu pliku."
      },
      "url" : {
        "type" : "string",
        "description" : "Adres URL, pod który należy wysłać żądanie pobrania części paczki.\nLink jest generowany dynamicznie w momencie odpytania o status operacji eksportu.\nNie podlega limitom API i nie wymaga przesyłania tokenu dostępowego przy pobraniu.\n\nOdpowiedź HTTP zawiera dodatkowe nagłówki:\n- `x-ms-meta-hash` – zaszyfrowanej części paczki, zakodowany w formacie Base64.",
        "format" : "uri"
      },
      "partSize" : {
        "minimum" : 1,
        "type" : "integer",
        "description" : "Rozmiar części paczki w bajtach.",
        "format" : "int64"
      },
      "partHash" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Sha256HashBase64"
          }
        ],
        "description" : "Skrót SHA256 pliku części paczki, zakodowany w formacie Base64."
      },
      "encryptedPartSize" : {
        "minimum" : 1,
        "type" : "integer",
        "description" : "Rozmiar zaszyfrowanej części paczki w bajtach.",
        "format" : "int64"
      },
      "encryptedPartHash" : {
        "allOf" : [
          {
            "$ref" : "#/components/schemas/Sha256HashBase64"
          }
        ],
        "description" : "Skrót SHA256 zaszyfrowanej części paczki, zakodowany w formacie Base64."
      },
      "expirationDate" : {
        "type" : "string",
        "description" : "Data i godzina wygaśnięcia linku umożliwiającego pobranie części paczki.\nPo upływie tego momentu link przestaje być aktywny.",
        "format" : "date-time"
      }
    },
    "additionalProperties" : false
  }


  "Sha256HashBase64" : {
    "maxLength" : 44,
    "minLength" : 44,
    "type" : "string",
    "description" : "SHA-256 w Base64.",
    "format" : "byte"
  }



//---------------------------------------------------------------------------------------------------
request: "/invoices/exports/{referenceNumber}": get: text/plain
headers:
Authorization: Bearer {securityToken}
body:
--- no body ---



response (200): application/json
{
  "status": { // required; type: object; items: #/components/schemas/StatusInfo; description: Status eksportu.

| Code | Description | Details |
| --- | --- | --- |
| 100 | Eksport faktur w toku | - |
| 200 | Eksport faktur zakończony sukcesem | - |
| 210 | Eksport faktur wygasł i nie jest już dostępny do pobrania | - |
| 415 | Błąd odszyfrowania dostarczonego klucza  | - |
| 420 | Zakres filtrowania wykracza poza dostępny zakres danych | Parametr dateRange.from jest późniejszy niż PermanentStorageHwmDate przy włączonym restrictToPermanentStorageHwmDate. |
| 500 | Nieznany błąd ({statusCode}) | - |
| 550 | Operacja została anulowana przez system | Przetwarzanie zostało przerwane z przyczyn wewnętrznych systemu. Spróbuj ponownie |
    "code": 0, // required; type: integer; format: int32; description: Kod statusu
    "description": "", // required; type: string; description: Opis statusu
    "details": [ // type: array; nullable: true; description: Dodatkowe szczegóły statusu
    ]
  },
  "completedDate": "", // type: string; format: date-time; nullable: true; description: Data zakończenia przetwarzania żądania eksportu faktur.
  "packageExpirationDate": "", // type: string; format: date-time; nullable: true; description: Data wygaśnięcia paczki faktur przygotowanej do pobrania.
Po upływie tej daty paczka nie będzie już dostępna do pobrania.
  "package": { // type: object; items: #/components/schemas/InvoicePackage; nullable: true; description: Dane paczki faktur przygotowanej do pobrania.
    "invoiceCount": 0, // required; type: integer; format: int64; description: Łączna liczba faktur w paczce.
    "size": 0, // required; type: integer; format: int64; description: Rozmiar paczki w bajtach.
    "parts": [ // required; type: array; description: Lista dostępnych części paczki do pobrania.
      {
        "ordinalNumber": 0, // required; type: integer; format: int32; description: Numer sekwencyjny pliku części paczki.
        "partName": "", // required; type: string; description: Nazwa pliku części paczki.
        "method": "", // required; type: string; description: Metoda HTTP, której należy użyć przy pobieraniu pliku.
        "url": "", // required; type: string; format: uri; description: Adres URL, pod który należy wysłać żądanie pobrania części paczki.
Link jest generowany dynamicznie w momencie odpytania o status operacji eksportu.
Nie podlega limitom API i nie wymaga przesyłania tokenu dostępowego przy pobraniu.

Odpowiedź HTTP zawiera dodatkowe nagłówki:
- `x-ms-meta-hash` – zaszyfrowanej części paczki, zakodowany w formacie Base64.
        "partSize": 0, // required; type: integer; format: int64; description: Rozmiar części paczki w bajtach.
        "partHash": "", // required; type: string; items: #/components/schemas/Sha256HashBase64; description: Skrót SHA256 pliku części paczki, zakodowany w formacie Base64.
        "encryptedPartSize": 0, // required; type: integer; format: int64; description: Rozmiar zaszyfrowanej części paczki w bajtach.
        "encryptedPartHash": "", // required; type: string; items: #/components/schemas/Sha256HashBase64; description: Skrót SHA256 zaszyfrowanej części paczki, zakodowany w formacie Base64.
        "expirationDate": "" // required; type: string; format: date-time; description: Data i godzina wygaśnięcia linku umożliwiającego pobranie części paczki.
Po upływie tego momentu link przestaje być aktywny.
      }
    ],
    "isTruncated": true/false, // required; type: boolean; description: Określa, czy wynik eksportu został ucięty z powodu przekroczenia limitu liczby faktur lub wielkości paczki.
    "lastIssueDate": "", // type: string; format: date; nullable: true; description: Data wystawienia ostatniej faktury ujętej w paczce.
Pole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `Issue`.
    "lastInvoicingDate": "", // type: string; format: date-time; nullable: true; description: Data przyjęcia ostatniej faktury ujętej w paczce.
Pole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `Invoicing`.
    "lastPermanentStorageDate": "", // type: string; format: date-time; nullable: true; description: Data trwałego zapisu ostatniej faktury ujętej w paczce.
Pole występuje wyłącznie wtedy, gdy paczka została ucięta i eksport był filtrowany po typie daty `PermanentStorage`.
    "permanentStorageHwmDate": "" // type: string; format: date-time; nullable: true; description: Dotyczy wyłącznie zapytań filtrowanych po typie daty <b>PermanentStorage</b>.
Jeśli zapytanie dotyczyło najnowszego okresu, wartość ta może być wartością nieznacznie skorygowaną względem górnej granicy podanej w warunkach zapytania.
Dla okresów starszych, będzie to zgodne z warunkami zapytania. 

System gwarantuje, że dane poniżej tej wartości są spójne i kompletne.
Ponowne zapytania obejmujące zakresem dane poniżej tego kroczącego znacznika czasu nie zwrócą w przyszłości innych wyników (np.dodatkowych faktur). 

Dla dateType = Issue lub Invoicing – null.
  }
}
